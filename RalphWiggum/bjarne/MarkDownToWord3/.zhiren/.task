TASK: Add image support (![alt](url)) → Images embed in Word document

ACTION: Add support for Markdown images (![alt text](url)) to WordGenerator

EXPECTED_OUTCOME: Images embed in Word document

EXISTING_CODE:
- WordGenerator.java handles headings, paragraphs, lists, inline formatting, code blocks, blockquotes
- processInlineContent() method handles inline content: Text, Emphasis, StrongEmphasis, Link, Code
- generate() method (lines 56-83) traverses AST and routes nodes to processor methods
- Comment on line 77: "Other node types (tables, horizontal rules, images, etc.) will be added in future tasks"
- XWPFRun methods used: setText(), setBold(), setItalic(), setColor(), setUnderline(), setFontFamily()
- Apache POI classes used: XWPFDocument, XWPFParagraph, XWPFRun

PATTERNS:
- instanceof checks for node type detection in AST traversal
- Separate helper methods for each node type (processHeading, processParagraph, etc.)
- processInlineContent() recursively processes inline children with inherited formatting
- XWPFParagraph created for block-level elements
- XWPFRun created within paragraphs for text segments

PLAN:
1. Understand flexmark image AST structure:
   - Image node: com.vladsch.flexmark.ast.Image
   - Image is an inline node (appears as child of Paragraph or other inline containers)
   - Image node contains:
     - URL: image source path (from url.getUrl())
     - Alt text: image description (from text content via toString() or getChars())
     - Title: optional tooltip (from title attribute)
   - Image nodes are NOT block-level - they appear within paragraphs

2. Add imports for image node:
   - import com.vladsch.flexmark.ast.Image;
   - import org.apache.poi.xwpf.usermodel.XWPFPictureData;
   - import org.apache.poi.xwpf.usermodel.XWPFRun;
   - import java.io.FileInputStream;
   - import java.io.InputStream;

3. Process images in processInlineContent() method:
   - Add instanceof check for Image node
   - Route to new processImage() helper method
   - Pass wordParagraph and inherited formatting parameters

4. Understand Apache POI image embedding:
   - XWPFRun.addPicture() method to embed images
   - Requires InputStream for image data
   - Supports formats: PNG, JPEG, GIF, WMF, etc.
   - Picture dimensions: width, height (in EMU - English Metric Units)
   - 1 EMU = 1/360,000 inch = 1/912,000 cm
   - Default dimensions: use 200x200 pixels or calculate from image

5. Implementation approach for image loading:
   - Option A: Load from URL (complex, requires HTTP client)
   - Option B: Load from local file path (simpler, more practical for CLI tool)
   - Decision: Use Option B (local file paths) - assumes images are local files
   - URL in Image node is treated as file path relative to input Markdown file

6. Code structure for processImage():
   ```java
   private void processImage(Image image, XWPFParagraph wordParagraph,
                           boolean inheritedBold, boolean inheritedItalic) throws Exception {
       // Extract image URL
       String imageUrl = image.getUrl().toString();

       // Extract alt text (for accessibility)
       String altText = image.getText().toString();
       if (altText.isEmpty()) {
           altText = imageUrl; // Fallback to URL if no alt text
       }

       // Create run for image
       XWPFRun run = wordParagraph.createRun();

       // Load and embed image from file
       try (InputStream is = new FileInputStream(imageUrl)) {
           // Add picture to document
           run.addPicture(is, XWPFDocument.PICTURE_TYPE_PNG);
           // Note: May need to detect file type from extension
       } catch (Exception e) {
           // If image loading fails, add alt text as placeholder
           run.setText("[Image: " + altText + "]");
       }
   }
   ```

7. File type detection:
   - Extract file extension from imageUrl
   - Map to XWPFDocument picture type constants:
     - .png → XWPFDocument.PICTURE_TYPE_PNG
     - .jpg/.jpeg → XWPFDocument.PICTURE_TYPE_JPEG
     - .gif → XWPFDocument.PICTURE_TYPE_GIF
     - Default: PICTURE_TYPE_PNG

8. Image sizing:
   - Use addPicture(is, type, width, height) overload
   - Or let Word auto-size using addPicture(is, type)
   - For initial implementation, let Word auto-size
   - Can add manual sizing later if needed

9. Error handling:
   - Image file not found → Display alt text as placeholder
   - Unsupported format → Display alt text as placeholder
   - Invalid path → Display alt text as placeholder
   - Wrap in try-catch to prevent conversion failure

10. Integration with processInlineContent():
    ```java
    } else if (child instanceof Image) {
        // Image ![alt](url)
        try {
            processImage((Image) child, wordParagraph, inheritedBold, inheritedItalic);
        } catch (Exception e) {
            // On error, create run with alt text placeholder
            XWPFRun run = wordParagraph.createRun();
            run.setText("[Image]");
        }
    }
    ```

11. Edge cases to handle:
    - Images with empty alt text
    - Images at end of paragraph
    - Multiple images in same paragraph
    - Images with bold/italic formatting (should not inherit)
    - Missing image files
    - Relative vs absolute paths

12. Update class JavaDoc:
    - Add "Images (![alt](url)) embedded in document" to supported elements list
    - Update line 42: "Tables, horizontal rules, images, and other elements" → "Tables, horizontal rules, and other elements"

13. Test scenarios:
    - Simple image with alt text
    - Image without alt text
    - Multiple images in same paragraph
    - Image with bold formatting
    - Missing image file
    - Different image formats (PNG, JPEG)

14. Files to modify:
    - MarkDownToWordSource/src/main/java/com/md2word/generator/WordGenerator.java
      - Add imports for Image, XWPFPictureData, FileInputStream, InputStream
      - Add processImage() helper method
      - Add Image handling in processInlineContent()
      - Update class JavaDoc to reflect image support

15. Additional imports needed:
    - import com.vladsch.flexmark.ast.Image;
    - import org.apache.poi.xwpf.usermodel.XWPFPictureData;
    - import java.io.FileInputStream;
    - import java.io.InputStream;

16. Method signature modification:
    - processInlineContent() may need to throw Exception
    - OR handle exceptions within processInlineContent()
    - Decision: Handle exceptions inline to avoid changing existing signature

FILES_TO_CREATE: None

TEST_COMMAND: mvn clean compile

OUTCOME_VERIFICATION:
- Compilation succeeds (mvn clean compile exits with 0)
- Code inspection confirms Image detection in processInlineContent()
- processImage() method exists and uses addPicture()
- Class JavaDoc mentions images in supported elements
