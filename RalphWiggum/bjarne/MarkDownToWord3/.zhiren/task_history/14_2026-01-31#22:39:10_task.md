# Implementation Plan: Task 69 - Add Unit Tests for PDF Conversion

## Task Analysis
**Action**: Add unit tests for PDF conversion
**Outcome**: TestPDFGenerator.java verifies PDF output correctness

**Current State**:
- No PDF tests exist (confirmed: no *PDF*.java files in src/test/java/com/md2word/)
- Existing test patterns in HeadingConversionTest, TextFormattingTest, ListConversionTest, TableConversionTest, IntegrationTest
- PDFGenerator has `public void generate(Document ast, Path outputPath) throws IOException` method
- All PDF features implemented: headings, text formatting, links, lists, code blocks, blockquotes, tables, images

## Requirements
1. Create PDFConversionTest.java in src/test/java/com/md2word/
2. Test all PDF features implemented so far
3. Follow existing test patterns (Arrange-Act-Assert structure)
4. Use JUnit 5 annotations (@Test, @DisplayName, @BeforeEach, @TempDir)
5. Verify PDF files are generated without errors
6. **Critical Requirement**: Tests must verify PDF output correctness
7. Cover edge cases and error conditions

## Testing Strategy

### Challenge: PDF Content Verification
Unlike Word documents (which can be inspected with Apache POI), PDF content verification is more difficult:
- PDFBox can load PDFs and extract text, but not formatting
- Cannot easily verify font sizes, styles, positions without complex parsing
- **Pragmatic Approach**:
  1. Test that PDF generation completes without errors (IOException)
  2. Test that PDF file is created and is valid (can be loaded by PDFBox)
  3. Test that PDF contains expected text content (text extraction)
  4. Test that PDF has expected number of pages
  5. NOT test visual formatting (font sizes, colors, positions) - too complex for unit tests

### PDFBox PDF Verification API
```java
// Load PDF
PDDocument doc = PDDocument.load(outputFile.toFile());

// Get page count
int pageCount = doc.getNumberOfPages();

// Extract text from page
PDFTextStripper textStripper = new PDFTextStripper();
String text = textStripper.getText(doc);

// Verify text contains expected content
assertTrue(text.contains("Expected Text"));
```

## Test Categories

### 1. Basic Document Generation (2 tests)
- Test simple paragraph generates valid PDF
- Test PDF file creation succeeds

### 2. Heading Tests (6 tests)
- Test heading level 1 (#) generates PDF with text
- Test heading level 2 (##) generates PDF with text
- Test heading level 3 (###) generates PDF with text
- Test heading level 4 (####) generates PDF with text
- Test heading level 5 (#####) generates PDF with text
- Test heading level 6 (######) generates PDF with text

### 3. Text Formatting Tests (3 tests)
- Test bold text (**text**) appears in PDF
- Test italic text (*text*) appears in PDF
- Test bold-italic text (***text***) appears in PDF

### 4. Link Tests (2 tests)
- Test link [text](url) appears in PDF text
- Test multiple links in document

### 5. List Tests (4 tests)
- Test unordered list (- items) appears in PDF
- Test ordered list (1. items) appears in PDF
- Test nested lists appear in PDF
- Test mixed list types

### 6. Code Block Tests (2 tests)
- Test fenced code block (```code```) appears in PDF
- Test inline code (`code`) appears in PDF

### 7. Blockquote Tests (2 tests)
- Test blockquote (> text) appears in PDF
- Test multi-line blockquote

### 8. Table Tests (2 tests)
- Test simple table appears in PDF
- Test table with multiple rows/columns

### 9. Image Tests (3 tests)
- Test image embedding generates valid PDF
- Test missing image falls back to alt text
- Test multiple images in document

### 10. Combined Elements Test (1 test)
- Test document with multiple element types

### 11. Edge Cases (2 tests)
- Test empty Markdown generates valid PDF
- Test Markdown with only whitespace

### 12. Error Handling (1 test)
- Test invalid Markdown still generates PDF

**Total Tests**: 30 tests

## Test File Structure

```java
package com.md2word;

import com.md2word.generator.PDFGenerator;
import com.md2word.parser.MarkdownParser;
import org.apache.pdfbox.pdmodel.PDDocument;
import org.apache.pdfbox.text.PDFTextStripper;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.io.TempDir;

import java.nio.file.Path;

import static org.junit.jupiter.api.Assertions.*;

@DisplayName("PDF Conversion Tests")
public class PDFConversionTest {

    private MarkdownParser parser;
    private PDFGenerator generator;

    @BeforeEach
    void setUp() {
        parser = new MarkdownParser();
        generator = new PDFGenerator();
    }

    // Tests here...
}
```

## Example Test Implementation

```java
@Test
@DisplayName("Simple paragraph should generate valid PDF")
void testSimpleParagraphGeneratesPDF(@TempDir Path tempDir) throws Exception {
    // Arrange
    String markdown = "This is a simple paragraph.";
    Path outputFile = tempDir.resolve("output.pdf");

    // Act
    var document = parser.parse(markdown);
    generator.generate(document, outputFile);

    // Assert
    assertTrue(outputFile.toFile().exists(), "PDF file should be created");
    assertTrue(outputFile.toFile().length() > 0, "PDF file should not be empty");

    // Verify PDF is valid and can be loaded
    try (PDDocument doc = PDDocument.load(outputFile.toFile())) {
        assertEquals(1, doc.getNumberOfPages(), "PDF should have 1 page");

        // Extract and verify text content
        PDFTextStripper textStripper = new PDFTextStripper();
        String text = textStripper.getText(doc);
        assertTrue(text.contains("simple paragraph"), "PDF should contain paragraph text");
    }
}
```

## Dependencies Required

Current pom.xml should have:
- **junit-jupiter** (already present)
- **pdfbox** (already present for main code)

No additional dependencies needed for tests.

## Implementation Steps

1. Create test file: `MarkDownToWordSource/src/test/java/com/md2word/PDFConversionTest.java`

2. Add imports:
   ```java
   import com.md2word.generator.PDFGenerator;
   import com.md2word.parser.MarkdownParser;
   import org.apache.pdfbox.pdmodel.PDDocument;
   import org.apache.pdfbox.text.PDFTextStripper;
   import org.junit.jupiter.api.BeforeEach;
   import org.junit.jupiter.api.DisplayName;
   import org.junit.jupiter.api.Test;
   import org.junit.jupiter.api.io.TempDir;
   import java.nio.file.Path;
   import static org.junit.jupiter.api.Assertions.*;
   ```

3. Implement setUp() method with @BeforeEach

4. Implement tests following the pattern above (30 tests total)

5. Run tests: `mvn test`

6. Verify all tests pass

## Test Naming Convention

Follow existing pattern: `test<Feature><Scenario>()`
- Examples:
  - `testSimpleParagraphGeneratesPDF()`
  - `testBoldTextAppearsInPDF()`
  - `testTableGeneratesPDF()`

## Assertions to Use

- `assertTrue(condition, message)` - For boolean checks
- `assertEquals(expected, actual, message)` - For exact value checks
- `assertNotNull(value, message)` - For null checks
- `assertFalse(condition, message)` - For negative checks

## Common Test Pattern

All tests follow this structure:
```java
@Test
@DisplayName("Descriptive test name")
void testMethodName(@TempDir Path tempDir) throws Exception {
    // Arrange: Prepare input markdown and output path
    String markdown = "...";
    Path outputFile = tempDir.resolve("output.pdf");

    // Act: Parse and generate PDF
    var document = parser.parse(markdown);
    generator.generate(document, outputFile);

    // Assert: Verify PDF is valid and contains expected content
    assertTrue(outputFile.toFile().exists());
    try (PDDocument doc = PDDocument.load(outputFile.toFile())) {
        // Verify page count, text content, etc.
    }
}
```

## Success Criteria

âœ… PDFConversionTest.java created with 30 tests
âœ… All tests follow existing test patterns
âœ… Tests verify PDF generation succeeds
âœ… Tests verify PDF files are valid (can be loaded)
âœ… Tests verify PDF contains expected text content
âœ… Tests cover all PDF features
âœ… Tests cover edge cases
âœ… All tests pass (mvn test)
âœ… No test failures or errors

## Files to Create/Modify

**New File**:
- `MarkDownToWordSource/src/test/java/com/md2word/PDFConversionTest.java` (estimated 400-500 lines)

**Verify Existing**:
- pom.xml (confirm pdfbox dependency is available for tests)

## Notes

- **Text extraction limitations**: PDFTextStripper extracts text but loses formatting
- **Font verification not feasible**: Cannot verify font sizes, bold, italic via text extraction
- **Alternative approaches considered**:
  * PDFBox font rendering API: Too complex for unit tests
  * PDF parsing libraries: Overkill for this use case
  * Visual comparison: Not suitable for automated unit tests
- **Pragmatic decision**: Verify text content and PDF validity, not visual formatting
- **Visual testing**: Manual verification via Tasks 70-71 will cover formatting quality

## Testing Limitations (Known & Accepted)

ðŸŸ¡ **Cannot verify visual formatting via unit tests**
- Font sizes, colors, styles (bold/italic) cannot be tested programmatically
- Text extraction strips formatting information
- This is a known limitation of PDF testing
- Manual testing (Tasks 70-71) will verify visual quality

ðŸŸ¡ **Cannot verify exact text positioning**
- Text location (X, Y coordinates) cannot be easily verified
- Page layout verification is complex
- Accepted limitation for unit tests

ðŸŸ¡ **Cannot verify table borders/grid**
- Table structure (borders, grid lines) not verifiable via text extraction
- Tables will be tested for text content only
- Manual testing will verify table rendering quality

## Coverage Goals

Target test coverage for PDFGenerator:
- Method coverage: 100% (all public/private methods)
- Line coverage: >80% (reasonable goal for PDF code)
- Feature coverage: 100% (all PDF features tested)
- Edge case coverage: Major edge cases tested

---
